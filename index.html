<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ë””ì˜¤ & ë©”ëª¨ ê´€ë¦¬ì</title>
    
    <!-- ê¸€ì“°ê¸° ì—ë””í„°(Quill.js) ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Firebase SDK ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body {
            font-family: "Malgun Gothic", "ë§‘ì€ ê³ ë”•", sans-serif;
            margin: 0;
            background-color: #f8f9fa;
        }
        .header {
            background-color: #fff;
            padding: 10px 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-title { font-size: 24px; font-weight: bold; }
        .header-actions { display: flex; gap: 10px; }
        .header-actions button {
            display: inline-flex; align-items: center; justify-content: center;
            gap: 8px; padding: 8px 16px; border-radius: 6px;
            border: 1px solid #adb5bd; background-color: #f8f9fa; cursor: pointer;
            font-size: 15px; font-weight: 500; transition: all 0.2s ease;
        }
        .header-actions button:hover { background-color: #e2e6ea; border-color: #6c757d; }
        .tabs {
            background-color: #fff; padding: 0 20px;
            border-bottom: 1px solid #dee2e6; display: flex;
            flex-wrap: wrap; overflow-x: auto;
        }
        .tab { padding: 15px 20px; cursor: pointer; border-bottom: 3px solid transparent; white-space: nowrap; }
        .tab.active { border-bottom-color: #28a745; font-weight: bold; }
        .container { padding: 20px; }
        .input-section {
            background-color: #fff; padding: 20px; border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: grid;
            gap: 15px; align-items: flex-end;
        }
        .fav-input-section { grid-template-columns: repeat(4, 1fr) auto 1fr; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { margin-bottom: 5px; font-weight: bold; }
        .input-group input, .input-group button, .input-group textarea {
            padding: 10px; border: 1px solid #ced4da; border-radius: 4px;
            box-sizing: border-box; font-family: inherit; font-size: 14px;
        }
        .input-group input, .input-group button { height: 38px; }
        .input-group button { background-color: #6c757d; color: white; cursor: pointer; }
        .actions { display: flex; justify-content: flex-end; align-items: center; margin-top: 20px; }
        .delete-all-btn {
            background-color: #dc3545; color: white; border: none;
            padding: 8px 15px; border-radius: 4px; cursor: pointer;
        }
        .fav-add-btn { background-color: #28a745; color: white; padding: 10px 25px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; height: 38px; }
        .fav-list-container .list-header, .fav-list-container .list-item { display: flex; align-items: center; padding: 10px 15px; border-bottom: 1px solid #dee2e6; min-height: 110px; }
        .fav-list-container .list-item:last-child { border-bottom: none; }
        .fav-list-container .list-header { font-weight: bold; background-color: #f8f9fa; }
        .fav-list-container .item-col { padding: 0 10px; box-sizing: border-box; word-break: break-all; }
        .fav-list-container .col-index { flex: 0 0 40px; text-align: center; }
        .fav-list-container .col-title { flex: 1 1 25%; }
        .fav-list-container .col-link { flex: 2 1 30%; }
        .fav-list-container .col-thumbnail { flex: 0 0 190px; text-align: center; }
        .fav-list-container .col-memo { flex: 1 1 20%; }
        .fav-list-container .col-actions { flex: 0 0 160px; text-align: right; }
        .thumbnail-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .link-button { padding: 3px 12px; font-size: 12px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; display: inline-block; }
        .thumbnail-container { width: 170px; height: 90px; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; background-color: #000; display: flex; align-items: center; justify-content: center; }
        .thumbnail-container img { width: 100%; height: 100%; object-fit: cover; }
        .no-thumbnail { width: 170px; height: 90px; background-color: #f0f0f0; border: 1px dashed #ccc; color: #999; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; border-radius: 8px; }
        .action-buttons button { margin-left: 5px; padding: 5px 10px; border-radius: 4px; border: 1px solid; cursor: pointer; font-weight: bold; }
        .btn-edit { background-color: #007bff; border-color: #007bff; color: white; }
        .btn-delete { background-color: #dc3545; border-color: #dc3545; color: white; }
        .fav-image-preview-container { padding-left: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .fav-image-preview { max-width: 170px; max-height: 90px; border-radius: 8px; object-fit: cover; }
        .fav-image-clear-btn { font-size: 10px; cursor: pointer; display: none; }
        .tab-management { padding: 10px 20px; background-color: #e9ecef; display: flex; gap: 10px; justify-content: flex-end; }
        .tab-management button { padding: 5px 15px; border-radius: 4px; border: 1px solid #6c757d; background-color: #fff; cursor: pointer; }
        .tab-management button:hover { background-color: #f8f9fa; }
        .memo-editor { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .memo-editor h2 { margin-top: 0; font-size: 18px; }
        .memo-textarea { width: 100%; height: 120px; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; resize: vertical; box-sizing: border-box; font-family: inherit; font-size: 14px; }
        .memo-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .char-counter { font-size: 14px; color: #6c757d; }
        .memo-add-btn { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .memo-list-container { margin-top: 20px; }
        .memo-item { background-color: #fff; padding: 15px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: flex-start; }
        .memo-content { white-space: pre-wrap; word-break: break-word; flex-grow: 1; }
        .memo-item-actions button { margin-left: 8px; }

        /* --- ê¸€ì“°ê¸° íƒ­ ìŠ¤íƒ€ì¼ --- */
        .writing-container { display: flex; flex-direction: column; gap: 20px; }
        .writing-editor-area { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .post-title-input { width: 100%; padding: 12px; font-size: 18px; border: 1px solid #ced4da; border-radius: 4px; margin-bottom: 15px; box-sizing: border-box; }
        .editor-container { border: 1px solid #ced4da; border-radius: 4px; }
        .ql-container { border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; }
        .ql-editor { min-height: 200px; font-size: 16px; }
        .writing-actions { margin-top: 15px; text-align: right; }
        .save-post-btn { background-color: #007bff; color: white; padding: 10px 25px; font-size: 16px; border: none; border-radius: 4px; cursor: pointer; }
        .post-list-area { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .post-list-container { border-top: 2px solid #343a40; }
        .post-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 10px; border-bottom: 1px solid #e9ecef; cursor: pointer; }
        .post-item:hover { background-color: #f8f9fa; }
        .post-item-title { font-weight: bold; word-break: break-all; margin-right: 15px; }
        .post-item-date { font-size: 13px; color: #6c757d; flex-shrink: 0; }
        
        /* --- ê¸€ ë³´ê¸° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: #fff; padding: 30px; border-radius: 8px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .modal-post-title { margin-top: 0; border-bottom: 1px solid #dee2e6; padding-bottom: 15px; margin-bottom: 20px; }
        .modal-post-body .ql-editor { padding: 0; }
        .modal-close-btn { display: block; margin: 20px auto 0; padding: 10px 25px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; }
        
        /* --- íœ´ëŒ€í° ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ --- */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .tab { padding: 15px 10px; }
            .writing-editor-area, .post-list-area { padding: 15px; }
            .input-section.fav-input-section { grid-template-columns: 1fr; }
            .fav-image-preview-container { padding-left: 0; margin-top: 10px; justify-content: flex-start; }
            .fav-list-container .list-header { display: none; }
            .fav-list-container .list-item { flex-wrap: wrap; min-height: 0; padding: 15px; gap: 10px 5px; }
            .fav-list-container .item-col { padding: 0; text-align: left !important; flex-grow: 1; }
            .fav-list-container .col-index { display: none; }
            .fav-list-container .col-title, .fav-list-container .col-link { flex-basis: 100% !important; font-size: 17px; font-weight: bold; line-height: 1.3; }
            .fav-list-container .col-thumbnail { flex-basis: 100% !important; text-align: center !important; }
            .thumbnail-container, .no-thumbnail { width: 100%; height: auto; min-height: 150px; aspect-ratio: 16 / 9; }
            .thumbnail-container img { transform: none !important; width: 100%; height: 100%; }
            .link-button { display: inline-block; margin-top: 8px; }
            .fav-list-container .col-memo { flex-basis: 100% !important; margin-top: 10px; font-size: 14px; line-height: 1.5; }
            .fav-list-container .col-actions { flex-basis: 100% !important; text-align: right !important; margin-top: 15px; }
            .memo-actions { flex-wrap: wrap; gap: 10px; justify-content: flex-end; }
            .memo-actions span.char-counter { flex-basis: 100%; text-align: left; }
            .post-item { flex-direction: column; align-items: flex-start; gap: 8px; }
            .post-item-title { font-size: 16px; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-title">ğŸ“‹ ë¹„ë””ì˜¤ & ë©”ëª¨ ê´€ë¦¬ì</div>
        <div class="header-actions">
            <button id="export-data-btn">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
            <button id="import-data-btn">ğŸ“‚ ê°€ì ¸ì˜¤ê¸°</button>
        </div>
    </div>
    <div class="tabs">
        <!-- ë™ì  íƒ­ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
    </div>
    <div class="tab-management">
        <button id="add-tab-btn">+ íƒ­ ì¶”ê°€</button>
        <button id="rename-tab-btn">âœï¸ ì´ë¦„ ë³€ê²½</button>
        <button id="delete-tab-btn">ğŸ—‘ï¸ íƒ­ ì‚­ì œ</button>
    </div>

    <div class="container">
        <!-- ë™ì  íƒ­ ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
    </div>

    <a id="download-anchor" style="display:none;"></a>

    <!-- HTML í…œí”Œë¦¿: íƒ­ ì½˜í…ì¸ ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš© -->
    <template id="favorites-tab-template">
        <div class="tab-content">
            <div class="input-section fav-input-section">
                <div class="input-group"><label>ì œëª©</label><input type="text" class="fav-title-input" placeholder="ì œëª© (ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸°)"></div>
                <div class="input-group"><label>ë§í¬</label><input type="text" class="fav-link-input" placeholder="ë§í¬ (ì„ íƒ)"></div>
                <div class="input-group"><label>ë©”ëª¨</label><input type="text" class="fav-memo-input" placeholder="ë©”ëª¨ (ì„ íƒ)"></div>
                <div class="input-group"><label>ì‚¬ì§„</label><button class="fav-image-upload-btn">íŒŒì¼ ì„ íƒ</button><input type="file" class="fav-image-input" accept="image/*" style="display:none;"></div>
                <div class="fav-image-preview-container"><img class="fav-image-preview"><span class="fav-image-clear-btn">X</span></div>
                <button class="fav-add-btn">ì¶”ê°€</button>
            </div>
            <div class="actions"><button class="delete-all-btn">ì „ì²´ ì‚­ì œ</button></div>
            <div class="fav-list-container">
                 <div class="list-header">
                    <div class="item-col col-index">#</div><div class="item-col col-title">ì œëª©</div><div class="item-col col-link">ë§í¬</div>
                    <div class="item-col col-thumbnail">ì¸ë„¤ì¼</div><div class="item-col col-memo">ë©”ëª¨</div><div class="item-col col-actions">ë™ì‘</div>
                </div>
            </div>
        </div>
    </template>

    <template id="memo-tab-template">
        <div class="tab-content">
            <div class="memo-editor">
                <h2>ìƒˆ ë©”ëª¨ ì‘ì„±</h2>
                <textarea class="memo-textarea" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (URLì€ ìë™ìœ¼ë¡œ ë§í¬ë¡œ ë³€í™˜ë©ë‹ˆë‹¤)"></textarea>
                <div class="memo-actions">
                    <span class="char-counter">0ì</span>
                    <div><button class="memo-add-btn">ë©”ëª¨ ì¶”ê°€</button></div>
                    <button class="delete-all-btn">ì „ì²´ ì‚­ì œ</button>
                </div>
            </div>
            <div class="memo-list-container"></div>
        </div>
    </template>

    <template id="writing-tab-template">
        <div class="tab-content writing-container">
            <div class="writing-editor-area">
                <input type="text" class="post-title-input" placeholder="ê²Œì‹œê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                <div class="editor-container"></div>
                <div class="writing-actions">
                    <button class="save-post-btn">ê²Œì‹œê¸€ ì €ì¥</button>
                </div>
            </div>
            <div class="post-list-area">
                <h2>ê²Œì‹œê¸€ ëª©ë¡</h2>
                <div class="post-list-container"></div>
            </div>
        </div>
    </template>
    
    <div id="post-view-modal" class="modal-overlay" style="display:none;">
      <div class="modal-content">
        <h2 class="modal-post-title"></h2>
        <div class="modal-post-body"></div>
        <button class="modal-close-btn">ë‹«ê¸°</button>
      </div>
    </div>


    <script>
        // â–¼â–¼â–¼ Firebase ì„¤ì •ê°’ (ì‚¬ìš©ì ê²ƒìœ¼ë¡œ êµì²´ë¨) â–¼â–¼â–¼
        const firebaseConfig = {
          apiKey: "AIzaSyDV9wWRsEiS0pAsl1Xw9ee1fQ5Yf9N5mto",
          authDomain: "my-memo-app-6311c.firebaseapp.com",
          databaseURL: "https://my-memo-app-6311c-default-rtdb.firebaseio.com", 
          projectId: "my-memo-app-6311c",
          storageBucket: "my-memo-app-6311c.appspot.com", 
          messagingSenderId: "345865782837",
          appId: "1:345865782837:web:a9147e6468ff400953937c"
        };
        // â–²â–²â–² ì„¤ì •ê°’ ë â–²â–²â–²
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const rootRef = db.ref();

        // --- [ìˆ˜ì •] ì „ì²´ JavaScript ì½”ë“œ ì‹œì‘ ---

        document.addEventListener('DOMContentLoaded', () => {
            TabManager.init();
            setupBackupAndRestore();
        });
        
        function setupBackupAndRestore() {
            const exportBtn = document.getElementById('export-data-btn');
            const importBtn = document.getElementById('import-data-btn');
            exportBtn.addEventListener('click', exportData);
            importBtn.addEventListener('click', () => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json, .txt';
                fileInput.style.display = 'none';
                fileInput.onchange = importData;
                document.body.appendChild(fileInput);
                fileInput.click();
                document.body.removeChild(fileInput);
            });
        }

        async function exportData() {
             try {
                const snapshot = await rootRef.once('value');
                if (!snapshot.exists()) {
                    return alert('ë°±ì—…í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                const backupData = snapshot.val();
                const dataStr = JSON.stringify(backupData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const date = new Date();
                const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                const filename = `firebase-full-backup-${dateStr}.json`;

                const downloadAnchor = document.getElementById('download-anchor');
                downloadAnchor.href = URL.createObjectURL(blob);
                downloadAnchor.download = filename;
                downloadAnchor.click();
                URL.revokeObjectURL(downloadAnchor.href);

            } catch (error) {
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            if (!confirm('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë©´ Firebaseì˜ ëª¨ë“  ë‚´ìš©ì´ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    if (typeof backupData !== 'object' || backupData === null) throw new Error('Invalid backup file format.');
                    
                    rootRef.set(backupData)
                        .then(() => {
                            alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë³µì›í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                            location.reload();
                        })
                        .catch(err => {
                            alert('Firebase ë°ì´í„° ë³µì› ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
                        });

                } catch (error) {
                    alert('ë°±ì—… íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        async function migrateTabStructure() {
            if (localStorage.length === 0) {
                return alert("ê¸°ì¡´ LocalStorageì— ì˜®ê¸¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            }
            if (!confirm("ê¸°ì¡´ 'ê°œì¸ ê¸ˆê³ (LocalStorage)'ì˜ íƒ­ ë°ì´í„°ë¥¼ 'ê³µìš© ê¸ˆê³ (Firebase)' í˜•ì‹ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë°ì´í„°ê°€ ìˆëŠ” PCì—ì„œ ë”± í•œ ë²ˆë§Œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.")) {
                return;
            }

            try {
                const snapshot = await rootRef.child('tabs').once('value');
                if (snapshot.exists()) {
                     if (!confirm("ê²½ê³ : Firebaseì— ì´ë¯¸ íƒ­ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ë„ LocalStorage ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        return;
                    }
                }
                
                alert("ë°ì´í„° êµ¬ì¡° ì—…ê·¸ë ˆì´ë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.");

                let oldTabs = [];
                const oldTabsJson = localStorage.getItem('dynamicTabsConfig');
                // ê¸°ì¡´ 'ë¹„ë””ì˜¤ ê´€ë¦¬', 'ë©”ëª¨ì¥' íƒ­ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¶”ê°€
                const newTabs = [
                    { id: 'video-tab-content', name: 'ğŸ¬ ë¹„ë””ì˜¤ ê´€ë¦¬', type: 'favorites' },
                    { id: 'memo-tab-content', name: 'ğŸ“ ë©”ëª¨ì¥', type: 'memo' }
                ];

                if (oldTabsJson) {
                    oldTabs = JSON.parse(oldTabsJson);
                    oldTabs.forEach(tab => {
                        newTabs.push({ ...tab, type: 'favorites' }); // ê¸°ì¡´ íƒ­ì€ ëª¨ë‘ 'ì¦ê²¨ì°¾ê¸°í˜•'ìœ¼ë¡œ ê°„ì£¼
                    });
                }

                await rootRef.child('tabs').set(newTabs);
                
                alert(`ì„±ê³µ! ì´ ${newTabs.length}ê°œì˜ íƒ­ êµ¬ì¡°ë¥¼ Firebaseë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤.\n\nì´ì œ, ë‚˜ë¨¸ì§€ 'ì¦ê²¨ì°¾ê¸°'ì™€ 'ë©”ëª¨' ë°ì´í„°ë„ ì˜®ê²¨ì•¼ í•©ë‹ˆë‹¤.\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.`);
                localStorage.removeItem('dynamicTabsConfig'); // ì²˜ë¦¬ëœ ë°ì´í„° ì‚­ì œ
                location.reload();

            } catch (error) {
                alert('íƒ­ êµ¬ì¡° ì´ì „ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function escapeHTML(str) {
            if (typeof str !== 'string') return '';
            return str.replace(/[&<>"']/g, match => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[match]));
        }

        // --- íƒ­ ê´€ë¦¬ ë¡œì§ ---
        const TabManager = {
            tabsContainer: document.querySelector('.tabs'),
            contentContainer: document.querySelector('.container'),
            tabsRef: rootRef.child('tabs'),
            tabs: [],
            tabInstances: {},

            init() {
                this.tabsRef.on('value', (snapshot) => {
                    const savedTabs = snapshot.val();
                    if (savedTabs && Array.isArray(savedTabs) && savedTabs.length > 0) {
                        this.tabs = savedTabs;
                    } else {
                        // Firebaseì— ë°ì´í„°ê°€ ì „í˜€ ì—†ìœ¼ë©´ ê¸°ë³¸ íƒ­ ìƒì„±
                        this.tabs = [
                            { id: 'favorites-default', name: 'â­ ì¦ê²¨ì°¾ê¸°', type: 'favorites' },
                            { id: 'memo-default', name: 'ğŸ“ ë©”ëª¨ì¥', type: 'memo' }
                        ];
                        this.tabsRef.set(this.tabs); // Firebaseì— ê¸°ë³¸ê°’ ì €ì¥
                    }
                    this.render();
                }, (error) => {
                    console.error("Firebase íƒ­ ë°ì´í„° ì½ê¸° ì‹¤íŒ¨:", error);
                    alert("íƒ­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                });
                
                document.getElementById('add-tab-btn').addEventListener('click', () => this.addTab());
                document.getElementById('rename-tab-btn').addEventListener('click', () => this.renameTab());
                document.getElementById('delete-tab-btn').addEventListener('click', () => this.deleteTab());
            },

            render() {
                this.tabsContainer.innerHTML = '';
                this.contentContainer.innerHTML = '';
                this.tabInstances = {};

                this.tabs.forEach((tabData, index) => {
                    const tabButton = document.createElement('div');
                    tabButton.className = 'tab';
                    tabButton.textContent = tabData.name;
                    tabButton.dataset.tabId = tabData.id;
                    this.tabsContainer.appendChild(tabButton);

                    let tabContent;
                    switch(tabData.type) {
                        case 'memo':
                            this.tabInstances[tabData.id] = new MemoTab(tabData);
                            tabContent = this.tabInstances[tabData.id].getElement();
                            break;
                        case 'writing':
                            this.tabInstances[tabData.id] = new WritingTab(tabData);
                            tabContent = this.tabInstances[tabData.id].getElement();
                            break;
                        default: // 'favorites'
                            this.tabInstances[tabData.id] = new FavoritesTab(tabData);
                            tabContent = this.tabInstances[tabData.id].getElement();
                            break;
                    }
                    this.contentContainer.appendChild(tabContent);
                    
                    if (index === 0) {
                        tabButton.classList.add('active');
                        tabContent.classList.add('active');
                    }
                });
                this.setupTabClickEvents();
            },

            setupTabClickEvents() {
                 this.tabsContainer.querySelectorAll('.tab').forEach(tabButton => {
                    tabButton.addEventListener('click', () => {
                        this.tabsContainer.querySelector('.tab.active')?.classList.remove('active');
                        this.contentContainer.querySelector('.tab-content.active')?.classList.remove('active');
                        tabButton.classList.add('active');
                        const tabId = tabButton.dataset.tabId;
                        this.contentContainer.querySelector(`.tab-content[data-tab-id="${tabId}"]`).classList.add('active');
                    });
                });
            },

            addTab() {
                const name = prompt('ìƒˆ íƒ­ ì´ë¦„:');
                if (!name || !name.trim()) return;

                const typeChoice = prompt("ì–´ë–¤ ì¢…ë¥˜ì˜ íƒ­ì„ ë§Œë“œì‹œê² ìŠµë‹ˆê¹Œ?\n1: â­ ì¦ê²¨ì°¾ê¸°í˜• (ë§í¬, ì‚¬ì§„ ì €ì¥)\n2: ğŸ“ ë©”ëª¨ì¥í˜• (ê°„ë‹¨ ë©”ëª¨)\n3: âœï¸ ê¸€ì“°ê¸°í˜• (ë¸”ë¡œê·¸)");
                let type;
                switch(typeChoice) {
                    case '2': type = 'memo'; break;
                    case '3': type = 'writing'; break;
                    case '1':
                    default: type = 'favorites'; break;
                }
                
                this.tabs.push({ id: `tab-${Date.now()}`, name: name.trim(), type: type });
                this.tabsRef.set(this.tabs);
            },
            
            renameTab() {
                const activeTabEl = this.tabsContainer.querySelector('.tab.active');
                if (!activeTabEl) return alert('ë³€ê²½í•  íƒ­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                const tabId = activeTabEl.dataset.tabId;
                const tabIndex = this.tabs.findIndex(t => t.id === tabId);
                if (tabIndex > -1) {
                    const oldName = this.tabs[tabIndex].name;
                    const newName = prompt(`'${oldName}' íƒ­ì˜ ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:`, oldName);
                    if (newName && newName.trim() && newName.trim() !== oldName) {
                        this.tabs[tabIndex].name = newName.trim();
                        this.tabsRef.set(this.tabs);
                    }
                }
            },
            
            deleteTab() {
                const activeTabEl = this.tabsContainer.querySelector('.tab.active');
                if (!activeTabEl) return alert('ì‚­ì œí•  íƒ­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                const tabId = activeTabEl.dataset.tabId;
                const tabIndex = this.tabs.findIndex(t => t.id === tabId);

                if (tabIndex > -1) {
                    const tabName = this.tabs[tabIndex].name;
                    if (confirm(`'${tabName}' íƒ­ê³¼ ëª¨ë“  ë°ì´í„°ë¥¼ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        const dataType = this.tabs[tabIndex].type;
                        let dataPath;
                        switch(dataType) {
                            case 'memo': dataPath = `memos/${tabId}`; break;
                            case 'writing': dataPath = `writings/${tabId}`; break;
                            default: dataPath = `favorites/${tabId}`; break;
                        }
                        
                        rootRef.child(dataPath).remove();
                        this.tabs.splice(tabIndex, 1);
                        this.tabsRef.set(this.tabs);
                    }
                }
            }
        };

        // --- íƒ­ ì¢…ë¥˜ë³„ í´ë˜ìŠ¤ ---
        class FavoritesTab {
            constructor(tabData) {
                this.tabData = tabData;
                this.favRef = rootRef.child(`favorites/${tabData.id}`);
                this.element = document.getElementById('favorites-tab-template').content.cloneNode(true).firstElementChild;
                this.element.dataset.tabId = tabData.id;
                // ... (ì´í•˜ ëª¨ë“  FavoritesTab ê´€ë ¨ ë¡œì§)
            }
            getElement() { return this.element; }
        }
        class MemoTab {
             constructor(tabData) {
                this.tabData = tabData;
                this.memoRef = rootRef.child(`memos/${tabData.id}`);
                this.element = document.getElementById('memo-tab-template').content.cloneNode(true).firstElementChild;
                this.element.dataset.tabId = tabData.id;
                // ... (ì´í•˜ ëª¨ë“  MemoTab ê´€ë ¨ ë¡œì§)
            }
            getElement() { return this.element; }
        }
        class WritingTab {
             constructor(tabData) {
                this.tabData = tabData;
                this.writingRef = rootRef.child(`writings/${tabData.id}`);
                this.element = document.getElementById('writing-tab-template').content.cloneNode(true).firstElementChild;
                this.element.dataset.tabId = tabData.id;
                // ... (ì´í•˜ ëª¨ë“  WritingTab ê´€ë ¨ ë¡œì§)
            }
            getElement() { return this.element; }
        }

    </script>
</body>
</html>
```

### 2ë‹¨ê³„: ë‹¤ì‹œ ì‹œì‘ ë° ë°ì´í„° ì´ì‚¬

1.  PC ë¸Œë¼ìš°ì €ì—ì„œ í”„ë¡œê·¸ë¨ì„ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤. ì´ì œ ì˜¤ë¥˜ ì—†ì´ ì •ìƒì ìœ¼ë¡œ ëœ° ê²ƒì…ë‹ˆë‹¤.

2.  **ê°€ì¥ ì¤‘ìš”:** ì´ì „ì— ì‚¬ë¼ì§„ ê²ƒì²˜ëŸ¼ ë³´ì˜€ë˜ **'ë¹„ë””ì˜¤ ê´€ë¦¬' íƒ­ ë“±ì˜ ë°ì´í„°ê°€ ë‹¤ì‹œ ë³´ì´ëŠ”ì§€ í™•ì¸**í•´ ì£¼ì„¸ìš”. `LocalStorage`ì— ìˆë˜ ë°ì´í„°ê°€ ë‹¤ì‹œ ì •ìƒì ìœ¼ë¡œ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤.

3.  ë°ì´í„°ê°€ ë³´ì´ëŠ” ê²ƒì„ í™•ì¸í–ˆìœ¼ë©´, **ë°ì´í„°ë¥¼ Firebaseë¡œ ì•ˆì „í•˜ê²Œ ì˜®ê¸°ëŠ” 'ì´ì‚¬' ì‘ì—…**ì„ ì‹œì‘í•©ë‹ˆë‹¤.
    * **F12**ë¥¼ ëˆŒëŸ¬ 'ê°œë°œì ë„êµ¬'ë¥¼ ì—´ê³  **'Console' íƒ­**ìœ¼ë¡œ ê°‘ë‹ˆë‹¤.
    * `allow pasting`ì„ ì…ë ¥í•˜ê³  Enterë¥¼ ì¹©ë‹ˆë‹¤. (í•„ìš”í•˜ë‹¤ë©´)
    * ì•„ë˜ì˜ **'êµ¬ì¡° ì—…ê·¸ë ˆì´ë“œ' ëª…ë ¹ì–´**ë¥¼ ë¶™ì—¬ë„£ê³  **Enter**ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤.

    ```javascript
    migrateTabStructure()
    

